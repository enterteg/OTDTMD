$(document).ready ->
  set_pin()
  $('#refresh_pin_button').click( (e) ->
    refresh_pin()
  )

refresh_pin = -> 
  $('#location_pin').remove()
  $('#map_photo').off('click')
  set_pin()


set_pin = ->
  map = $('#map_photo')
  map.css( 'cursor', 'url(<%= asset_path "flag.png" %>), auto' )

  map.on('click', (e)->
    offset = $(this).offset()

    left_offset = ( (e.pageX - offset.left) / $(this).width() ) * 100
    top_offset = ( (e.pageY - offset.top) / $(this).height() ) * 100

    add_pin(left_offset, top_offset)
    map.off('click')
    map.css( 'cursor', 'auto' )
  )

add_pin = (x,y) ->
	map = $('#map_photo')
	$('<div>').addClass('map_pin').attr('id', 'location_pin')
    .css({'left': x + '%', 'top': y+'%'})
	.appendTo('#map_photo')

